import{d as e,e as a,f as l,g as s,h as t,i as o}from"./element-plus-Cb_SbdhD.js";import{_ as n}from"./index-Dx21fTPJ.js";import{r as i,w as u,a2 as c,o as r,M as d,O as p,a as m,L as f,_ as g,u as h,c as v,J as _,a3 as b,W as y,P as j,z as x,aa as k,ab as w}from"./@vue-tSB00H7h.js";import{r as C,u as S,w as N}from"./xlsx-CN1O3t_i.js";import"./@element-plus-DsegFYNA.js";import"./@ctrl-D2oWfImC.js";import"./@vueuse-CzmXuOC9.js";import"./lodash-es-DNconrI1.js";import"./@popperjs-D3lHDW-0.js";import"./vue-router-BZ7BdOmr.js";import"./path-browserify-Cry6LdJB.js";import"./dayjs-CXUWDbkB.js";import"./default-passive-events-DAEqUm54.js";const V=(e=>(k("data-v-d1d46af9"),e=e(),w(),e))((()=>m("p",null,"将文件拖到此处或点击上传",-1))),B={key:0,class:"file-list"},E={class:"dialog-footer"},H=n(Object.assign({name:"UploadDialog"},{__name:"UploadDialog",props:{dialogVisible:{type:Boolean,default:!1},width:{type:[String,Number],default:"500"},title:{type:String,default:"上传"},modal:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},limit:{type:Number,default:3},accept:{type:[String,Array],default:".xls,.xlsx"},loading:{type:Boolean,default:!1}},emits:["on-confirm","on-cancel"],setup(o,{emit:n}){const k=o,w=n,C=i(!1),S=i([]),N=i(!1);function H(a){return S.value.length<k.limit?S.value.push(a):e.warning("最多允许上传".concat(k.limit,"个文件")),!1}function O(){w("on-cancel"),S.value=[]}function D(){0===S.value.length?e.error("请选择要上传的文件"):w("on-confirm",S.value)}return u((()=>k.dialogVisible),(e=>{C.value=e}),{immediate:!0}),(e,n)=>{const i=c("upload-filled"),u=a,k=l,w=c("CircleClose"),I=s,P=t;return r(),d(P,{modelValue:h(C),"onUpdate:modelValue":n[0]||(n[0]=e=>x(C)?C.value=e:null),title:o.title,width:o.width,modal:o.modal,draggable:o.draggable,"before-close":O},{footer:p((()=>[m("div",E,[f(I,{onClick:O},{default:p((()=>[g("取消")])),_:1}),f(I,{type:"primary",loading:o.loading,onClick:D},{default:p((()=>[g("确定")])),_:1},8,["loading"])])])),default:p((()=>[f(k,{multiple:o.multiple,limit:o.limit,drag:"",action:"",accept:o.accept,"before-upload":H,disabled:h(N)},{default:p((()=>[f(u,{class:"el-icon--upload"},{default:p((()=>[f(i)])),_:1}),V])),_:1},8,["multiple","limit","accept","disabled"]),h(S).length>0?(r(),v("ul",B,[(r(!0),v(_,null,b(h(S),(e=>(r(),v("li",{key:e.uid,class:"file-box"},[m("span",null,y(e.name),1),f(u,{class:"icon-del",size:"16px",onClick:a=>function(e){const a=S.value.findIndex((a=>a.uid===e.uid));-1!==a&&S.value.splice(a,1)}(e)},{default:p((()=>[f(w)])),_:2},1032,["onClick"])])))),128))])):j("",!0)])),_:1},8,["modelValue","title","width","modal","draggable"])}}}),[["__scopeId","data-v-d1d46af9"]]),O={class:"base-container container"},D={key:0,class:"tip"},I={key:1,class:"sheet-list"},P=["onClick"],U=n(Object.assign({name:"StudentClassHours"},{__name:"studentClassHours",setup(e){const a=i(!1),l=i(!1),t=i([]),n=[3,4,5,6,7,8,11,12,13,14,15,16,19,20,21,22,23,24,27,28,29,30,31,32,35,36,37,38,39,40,43,44,45,46,47,48];function u(){a.value=!0}function c(){a.value=!1}async function d(e){var s;l.value=!0,t.value=await(s=e[0],new Promise((e=>{const a=new FileReader;a.onload=a=>{const l=a.target.result,s=C(l,{type:"binary"});console.log("excel原始数据",s);const t=[];s.SheetNames.forEach((e=>{const a={sheetName:e,sheetData:S.sheet_to_json(s.Sheets[e])};t.push(a)})),console.log("json序列化后的excel数据",t),e(t)},a.readAsBinaryString(s)}))),l.value=!1,a.value=!1,1===t.value.length&&m(t.value[0])}function m(e){const a=[];e.sheetData.forEach((e=>{if(n.includes(e.__rowNum__))for(const l in e)l.includes("EMPTY")&&a.push(e[l])})),console.log("学生姓名和对应的课时数据",a);const l={};a.forEach(((e,s)=>{s%2==0&&(l[e]?l[e].classHours.push(a[s+1]):l[e]={name:e,classHours:[a[s+1]],sum:0})}));let s=0;for(const n in l)l[n].classHours.forEach((e=>{l[n].sum+=e})),s+=l[n].sum;console.log("按照学生姓名分组的课时数据",l),console.log("所有学生的合计课时数据",s);const t=Object.values(l).map(((e,a)=>{const l={"序号":String(a+1),"姓名":e.name,"总计":e.sum};return e.classHours.forEach(((e,a)=>{l["第".concat(a+1,"节")]=e})),l})),o={"序号":"","姓名":"","总计":s};t.push(o),console.log("下载的数据格式",t),function(e,a){const l="".concat(a,".xlsx"),s="Sheet 1",t=S.book_new(),o=S.json_to_sheet(e);S.book_append_sheet(t,o,s),N(t,l)}(t,e.sheetName)}return(e,n)=>{const i=s,x=o,k=H;return r(),v("div",O,[f(x,{class:"card"},{default:p((()=>[f(i,{type:"primary",onClick:u},{default:p((()=>[g("上传文件")])),_:1}),h(t).length>1?(r(),v("p",D,"检测到存在多个Sheet页，请选择一个下载")):j("",!0),h(t).length>1?(r(),v("ul",I,[(r(!0),v(_,null,b(h(t),(e=>(r(),v("li",{key:e.sheetName,class:"sheet-item",onClick:a=>m(e)},y(e.sheetName),9,P)))),128))])):j("",!0)])),_:1}),f(k,{dialogVisible:h(a),accept:".xls,.xlsx",loading:h(l),onOnConfirm:d,onOnCancel:c},null,8,["dialogVisible","loading"])])}}}),[["__scopeId","data-v-403fb5f1"]]);export{U as default};
