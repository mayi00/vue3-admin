import{j as e,k as a,w as s,y as l,m as o,B as r,a6 as t,u as i,ad as d,C as u,D as n,av as c,a2 as m,i as p,r as f,E as v,aS as y,ai as h}from"./DFilHWvT.js";import{_,a as w}from"./C762OUmN.js";const b={class:"permission-wrapper"},k={class:"menu-tree-wrapper"},C=_({__name:"rolePermissionDrawer",props:{visible:{type:Boolean,default:!1},roleData:{type:Object,required:!0,default:()=>({})}},emits:["update:visible","success"],setup(_,{emit:C}){const D=_,g=C,I=f(!1),j=f(!1),P=f(null),x=f([]),V=f(""),B=async()=>{I.value=!0;try{Promise.all([w.sys.menu.list(),w.sys.role.getRolePermissions({roleId:D.roleData.id})]).then(([e,a])=>{x.value=e.data||[];const s=["2-1-1","2-1-1-1","1-2"];h(()=>{P.value?.setCheckedKeys(s)})})}catch(e){v.error("获取菜单权限失败"),console.error("获取菜单权限失败:",e)}finally{I.value=!1}},L=(e,a)=>!e||a.meta.title.toLowerCase().includes(e.toLowerCase()),N=()=>{P.value?.filter(V.value)},O=async()=>{if(D.roleData.id){j.value=!0;try{const e=P.value.getCheckedNodes().map(e=>e.id);await w.sys.role.assignPermissions({roleId:D.roleData.id,menuIds:e}),v.success("权限分配成功"),g("success"),g("update:visible",!1)}catch(e){v.error("权限分配失败"),console.error("权限分配失败:",e)}finally{j.value=!1}}},R=()=>{V.value="",g("update:visible",!1)};return(f,v)=>{const h=p("Search"),w=r,C=d,g=c,I=m,S=y;return e(),a(S,{"model-value":_.visible,title:`分配菜单权限 【${D.roleData.roleName}】`,size:"60%",class:"role-permission-drawer",onOpen:B,onClose:R},{footer:s(()=>[o(I,{type:"primary",onClick:O,loading:i(j)},{default:s(()=>[...v[1]||(v[1]=[u("确定",-1)])]),_:1},8,["loading"]),o(I,{onClick:R},{default:s(()=>[...v[2]||(v[2]=[u("取消",-1)])]),_:1})]),default:s(()=>[l("div",b,[o(C,{modelValue:i(V),"onUpdate:modelValue":v[0]||(v[0]=e=>t(V)?V.value=e:null),modelModifiers:{trim:!0},placeholder:"搜索菜单",clearable:"",style:{width:"100%"},onInput:N},{prefix:s(()=>[o(w,null,{default:s(()=>[o(h)]),_:1})]),_:1},8,["modelValue"]),l("div",k,[o(g,{ref_key:"menuTreeRef",ref:P,data:i(x),"filter-node-method":L,"show-checkbox":"","node-key":"id",class:"h-full"},{default:s(({node:e,data:a})=>[u(n(a.meta.title),1)]),_:1},8,["data"])])])]),_:1},8,["model-value","title"])}}},[["__scopeId","data-v-b77a6a06"]]);export{C as default};
