import{ax as e,j as a,k as l,w as s,m as t,u as o,a6 as u,aX as r,C as i,a2 as d,r as n,E as c,x as m,a8 as p}from"./DFilHWvT.js";import{a as v}from"./C762OUmN.js";const f={__name:"userRoleDialog",props:{visible:{type:Boolean,default:!1},userData:{type:Object,default:()=>{},required:!0}},emits:["update:visible","success"],setup(f,{emit:y}){const b=f,V=y,C=n(!1),h=n(!1),_=n([]),g=n([]),j=m(()=>`为 ${b.userData.name} 分配角色`);async function k(){try{h.value=!0,await v.sys.user.saveRoles({userId:b.userId,roles:_.value}),c.success("角色分配成功"),V("success")}catch(e){c.error("角色分配失败"),console.error(e)}finally{h.value=!1}}function x(){_.value=[],g.value=[],V("update:visible",!1)}return e(()=>b.visible,e=>{_.value=[],g.value=[],C.value=e,e&&async function(){try{h.value=!0,Promise.all([v.sys.user.getUserRoles(b.userData.id),v.sys.role.allList()]).then(e=>{_.value=e[0].data.map(e=>e.roleCode),g.value=e[1].data.map(e=>({key:e.roleCode,label:e.roleName,disabled:!1}))})}catch(e){c.error("获取角色数据失败"),console.error(e)}finally{h.value=!1}}()}),e(C,e=>{V("update:innerVisible",e)}),(e,n)=>{const c=r,m=d,v=p;return a(),l(v,{modelValue:o(C),"onUpdate:modelValue":n[1]||(n[1]=e=>u(C)?C.value=e:null),title:o(j),width:"600px",onClose:x},{footer:s(()=>[t(m,{type:"primary",loading:o(h),onClick:k},{default:s(()=>[...n[2]||(n[2]=[i("保存",-1)])]),_:1},8,["loading"]),t(m,{onClick:x},{default:s(()=>[...n[3]||(n[3]=[i("取消",-1)])]),_:1})]),default:s(()=>[t(c,{modelValue:o(_),"onUpdate:modelValue":n[0]||(n[0]=e=>u(_)?_.value=e:null),data:o(g),titles:["未选择角色","已选择角色"],filterable:"","filter-placeholder":"请输入角色名称"},null,8,["modelValue","data"])]),_:1},8,["modelValue","title"])}}};export{f as default};
