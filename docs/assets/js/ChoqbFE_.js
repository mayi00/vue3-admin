import{_ as e}from"./C6eypMRw.js";import{ax as a,i as l,j as t,k as n,w as i,m as s,a4 as o,u,B as r,y as d,D as c,p,G as m,H as f,aT as g,A as v,a2 as h,C as b,aK as y,a6 as _,a8 as w,x,E as S,r as k,aU as C,aV as N,f as B,ao as V,aa as z,af as E,ag as U,ab as j,ac as A,aA as D,a1 as W,ap as M,at as T,au as I,aR as P,R,aW as L,aB as $}from"./OcaL6beW.js";import{_ as F,b as G,h as K,a as H}from"./CFdA1usV.js";import{_ as O}from"./DqK7WFuo.js";import{a as Y,g as J}from"./CxAYDShj.js";import{u as Z}from"./BmeqqqNF.js";import q from"./aAhcORZ8.js";import Q from"./C-Njo8ST.js";function X(e,a,l=2){const t=["KB","MB","GB","TB","PB","EB","ZB","YB","BB"],n=t.indexOf(a);if(-1===n){const t=Math.max(0,Math.min(l,20));return{value:Number(e.toFixed(t)),unit:a}}let i=e,s=n;const o=Math.max(0,Math.min(l,20));for(;i>=1024&&s<t.length-1;)i/=1024,s++;return{value:Number(i.toFixed(o)),unit:t[s]}}const ee={class:"el-upload__tip"},ae={key:0,class:"file-list"},le={style:{"max-width":"300px","max-height":"200px","overflow-y":"auto"}},te={class:"file-name g-single-ellipsis"},ne=F(Object.assign({name:"HyUploadDialog"},{__name:"HyUploadDialog",props:{visible:{type:Boolean,default:!1},width:{type:[String,Number],default:"500"},title:{type:String,default:"上传文件"},multiple:{type:Boolean,default:!0},drag:{type:Boolean,default:!0},limit:{type:[Number,String],default:1},accept:{type:[String,Array],default:".xls,.xlsx"},loading:{type:Boolean,default:!1},maxSize:{type:[Number,String],default:5120}},emits:["confirm","cancel"],setup(e,{emit:C}){const N=e,B=C,V=k(!1),z=k([]),E=x(()=>N.limit>1&&N.multiple),U=x(()=>{const e=Number(N.limit);return isNaN(e)||e<1?1:e}),j=x(()=>N.drag?"将文件拖到此处或点击上传":"点击上传"),A=x(()=>z.value.length>=U.value),D=x(()=>Array.isArray(N.accept)?N.accept.join(","):N.accept);function W(){S.warning(`最多允许上传${N.limit}个文件`)}function M(e){if(!function(e){if(!N.accept)return!0;const a=e.name.toLowerCase();return(Array.isArray(N.accept)?N.accept:N.accept.split(",")).some(l=>{const t=l.trim().toLowerCase();return t.startsWith(".")?a.endsWith(t):e.type.includes(t.replace("*",""))})}(e))return S.error(`不支持的文件类型，请上传${D.value}格式的文件`),!1;const a=parseInt(N.maxSize);if(e.size/1024>a){const e=X(a,"KB");return S.error(`文件大小不能超过 ${e.value} ${e.unit}`),!1}if(z.value.length>=N.limit)return S.warning(`最多允许上传${N.limit}个文件`),!1;return z.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified)?(S.warning("已选择相同的文件，请重新选择"),!1):(z.value.push(e),!1)}function T(){B("cancel"),z.value=[]}function I(){0===z.value.length?S.error("请选择要上传的文件"):B("confirm",[...z.value])}return a(()=>N.visible,e=>{e&&(z.value=[]),V.value=e},{immediate:!0}),(a,x)=>{const S=l("upload-filled"),k=r,C=o,N=g,B=l("CircleClose"),P=h,R=w;return t(),n(R,y({modelValue:u(V),"onUpdate:modelValue":x[0]||(x[0]=e=>_(V)?V.value=e:null),title:e.title,width:e.width},a.$attrs,{"before-close":T}),{footer:i(()=>[s(P,{type:"primary",disabled:0===u(z).length,loading:e.loading,onClick:I},{default:i(()=>[...x[1]||(x[1]=[b(" 确定 ",-1)])]),_:1},8,["disabled","loading"]),s(P,{onClick:T},{default:i(()=>[...x[2]||(x[2]=[b("取消",-1)])]),_:1})]),default:i(()=>[s(C,{action:"",multiple:u(E),drag:e.drag,accept:u(D),"on-exceed":W,"before-upload":M,disabled:u(A),limit:u(U)},{tip:i(()=>[d("div",ee," 支持格式: "+c(u(D))+"，单个文件不超过 "+c(u(X)(parseInt(e.maxSize),"KB").value)+c(u(X)(parseInt(e.maxSize),"KB").unit),1)]),default:i(()=>[s(k,{class:"el-icon--upload"},{default:i(()=>[s(S)]),_:1}),d("p",null,c(u(j)),1)]),_:1},8,["multiple","drag","accept","disabled","limit"]),u(z).length>0?(t(),p("ul",ae,[(t(!0),p(m,null,f(u(z),e=>(t(),p("li",{key:e.uid,class:"file-box"},[s(N,{effect:"dark",content:e.name,placement:"top"},{content:i(()=>[d("p",le,c(e.name),1)]),default:i(()=>[d("span",te,c(e.name),1)]),_:2},1032,["content"]),s(k,{class:"file-del",size:"18px",onClick:a=>function(e){const a=z.value.findIndex(a=>a.uid===e.uid);-1!==a&&z.value.splice(a,1)}(e)},{default:i(()=>[s(B)]),_:1},8,["onClick"])]))),128))])):v("",!0)]),_:1},16,["modelValue","title","width"])}}}),[["__scopeId","data-v-c3d1f83c"]]);function ie(e){const{data:a,filename:l="导出数据",sheetName:t="数据",columnWidths:n=[],autoWidth:i=!0,merges:s=[]}=e,o=C.book_new(),u=C.json_to_sheet(a);if(s&&s.length&&(u["!merges"]=s),i){const e=Object.keys(a[0]);u["!cols"]=function(e,a){if(!(e&&e.length&&a&&a.length))return[];const l=a.map(()=>8);return e.forEach(e=>{a.forEach((a,t)=>{const n=2*(void 0!==e[a]&&null!==e[a]?String(e[a]):"").length+2;l[t]=Math.max(l[t],n)})}),l.map(e=>({wch:Math.min(e,50)}))}(a,e)}else n&&n.length&&(u["!cols"]=n);return C.book_append_sheet(o,u,t),N(o,`${l}.xlsx`),!0}const se={class:"g-container"},oe={class:"mb-[10px]"},ue={class:"g-multi-ellipsis"},re=Object.assign({name:"UserManage"},{__name:"userManage",setup(a){const{userInfo:l}=B(G().userStore),o=k(null),r=k({name:"",account:"",gender:"",status:"",roleName:""}),g=V(()=>{C.value.currentPage=1,X()},300);function y(){o.value.resetFields(),g()}const{elementHeight:w}=Z({offset:325}),x=k(null),C=k({loading:!1,currentPage:1,pageSize:10,total:0,data:[],columns:[{type:"selection",width:50},{type:"index",label:"序号",minWidth:60,slot:"index"},{prop:"avatar",label:"头像",slot:"avatar"},{prop:"account",label:"帐号",minWidth:100},{prop:"name",label:"姓名",minWidth:100},{prop:"roleName",label:"角色",minWidth:150,slot:"roleName"},{prop:"gender",label:"性别",minWidth:60,slot:"gender"},{prop:"status",label:"状态",minWidth:70,slot:"status"},{prop:"mobile",label:"手机",minWidth:120},{prop:"email",label:"电子邮箱",minWidth:120},{prop:"operation",label:"操作",width:180,align:"center",fixed:"right",slot:"operation"}]}),N=k([]);function F(e){return C.value.pageSize*(C.value.currentPage-1)+e+1}function X(){const e={currentPage:C.value.currentPage,pageSize:C.value.pageSize},a={...r.value};C.value.loading=!0,H.sys.user.list(e,a).then(e=>{C.value.data=e.data.list,C.value.total=e.data.total}).catch(()=>{C.value.data=[],C.value.total=0}).finally(()=>{C.value.loading=!1})}function ee(e){C.value.currentPage=e,X()}function ae(e){C.value.pageSize=e,X()}function le(e){N.value=e}function te(e){N.value=e}function re(e){}const de=k(!1),ce=k(!1),pe=k({});function me(){ce.value=!1,pe.value={},de.value=!0}function fe(){de.value=!1,pe.value={},X()}const ge=k(!1);function ve(){ge.value=!1,pe.value={},X()}function he(){const e=x.value?.getSelectionRows();if(!e.length)return S.warning("请选择数据");ie({data:be(e),filename:"用户数据",sheetName:"用户数据"})}function be(e){return e.map((e,a)=>({"序号":a+1,"帐号":e.account,"姓名":e.name,"角色":e.roleName.join("，"),"性别":J("GENDER",e.gender),"状态":J("SYS_ENABLED_STATUS",e.status),"手机":e.mobile,"电子邮箱":e.email}))}const ye=k(!1);function _e(){const e={currentPage:1,pageSize:C.value.total},a={...r.value};ye.value=!0,H.sys.user.list(e,a).then(e=>{ie({data:be(e.data.list),filename:"全部用户数据",sheetName:"用户数据"})}).catch(()=>{}).finally(()=>{ye.value=!1})}const we=k({visible:!1,loading:!1});function xe(){we.value.visible=!0}function Se(e){const a=new FormData;a.append("file",e[0]),we.value.loading=!0,H.sys.user.batchImport(a).then(e=>{we.value.loading=!1,we.value.visible=!1,S.success("导入成功"),X()})}function ke(){S.info("下载模板")}const Ce=k({ids:[],title:"删除",visible:!1,loading:!1});function Ne(){const e=x.value?.getSelectionRows();if(!e.length)return S.warning("请选择数据");Ce.value.ids=e.map(e=>e.id),Ce.value.title="批量删除",Ce.value.visible=!0}async function Be(){Ce.value.loading=!0;try{await H.sys.user.delete({ids:Ce.value.ids}),S({type:"success",message:"删除成功"}),Ce.value.visible=!1,Ce.value.loading=!1,X()}finally{Ce.value.loading=!1}}function Ve(){Ce.value.visible=!1,Ce.value.ids=[]}return X(),(a,k)=>{const N=A,B=j,V=U,G=$,Z=D,ie=h,be=E,ye=z,ze=W,Ee=R,Ue=P,je=I,Ae=T,De=O,We=ne,Me=e,Te=L("permission");return t(),p("div",se,[s(ze,{shadow:"hover","body-style":"padding-bottom: 0"},{default:i(()=>[s(ye,{ref_key:"searchFormRef",ref:o,model:u(r),"label-width":"80px"},{default:i(()=>[s(be,null,{default:i(()=>[s(V,{span:6},{default:i(()=>[s(B,{label:"帐号",prop:"account"},{default:i(()=>[s(N,{modelValue:u(r).account,"onUpdate:modelValue":k[0]||(k[0]=e=>u(r).account=e),placeholder:"请输入帐号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),s(V,{span:6},{default:i(()=>[s(B,{label:"姓名",prop:"name"},{default:i(()=>[s(N,{modelValue:u(r).name,"onUpdate:modelValue":k[1]||(k[1]=e=>u(r).name=e),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),s(V,{span:6},{default:i(()=>[s(B,{label:"性别",prop:"gender"},{default:i(()=>[s(Z,{modelValue:u(r).gender,"onUpdate:modelValue":k[2]||(k[2]=e=>u(r).gender=e),placeholder:"请选择性别",clearable:""},{default:i(()=>[(t(!0),p(m,null,f(u(Y)("GENDER"),e=>(t(),n(G,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(V,{span:6},{default:i(()=>[s(B,{label:"用户状态",prop:"status"},{default:i(()=>[s(Z,{modelValue:u(r).status,"onUpdate:modelValue":k[3]||(k[3]=e=>u(r).status=e),placeholder:"请选择用户状态",clearable:""},{default:i(()=>[(t(!0),p(m,null,f(u(Y)("SYS_ENABLED_STATUS"),e=>(t(),n(G,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(V,{span:6},{default:i(()=>[s(B,{label:"角色名称",prop:"roleName"},{default:i(()=>[s(N,{modelValue:u(r).roleName,"onUpdate:modelValue":k[4]||(k[4]=e=>u(r).roleName=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),s(V,{span:18,style:{"padding-left":"10px"}},{default:i(()=>[s(ie,{type:"primary",onClick:u(g)},{default:i(()=>[...k[8]||(k[8]=[b("查询",-1)])]),_:1},8,["onClick"]),s(ie,{onClick:y},{default:i(()=>[...k[9]||(k[9]=[b("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(ze,{shadow:"hover",style:{"margin-top":"10px"}},{default:i(()=>[d("div",oe,[M((t(),n(ie,{type:"primary",onClick:me},{default:i(()=>[...k[10]||(k[10]=[b("新增",-1)])]),_:1})),[[Te,"sys:user:add"]]),M((t(),n(ie,{type:"primary",onClick:he},{default:i(()=>[...k[11]||(k[11]=[b("批量下载",-1)])]),_:1})),[[Te,"sys:user:download"]]),u(K)("sys:user:downloadAll")&&u(l).roleCodes.includes("superAdmin")?(t(),n(ie,{key:0,type:"primary",onClick:_e},{default:i(()=>[...k[12]||(k[12]=[b(" 全部下载 ",-1)])]),_:1})):v("",!0),M((t(),n(ie,{type:"default",onClick:xe},{default:i(()=>[...k[13]||(k[13]=[b(" 批量导入 ",-1)])]),_:1})),[[Te,"sys:user:batchImport"]]),M((t(),n(ie,{type:"default",onClick:ke},{default:i(()=>[...k[14]||(k[14]=[b(" 下载模板 ",-1)])]),_:1})),[[Te,"sys:user:downloadTemplate"]]),M((t(),n(ie,{type:"danger",onClick:Ne},{default:i(()=>[...k[15]||(k[15]=[b("批量删除",-1)])]),_:1})),[[Te,"sys:user:batchDelete"]])]),s(De,{ref_key:"hyTableRef",ref:x,height:u(w),loading:u(C).loading,data:u(C).data,columns:u(C).columns,total:u(C).total,onSelect:le,onSelectAll:te,onSelectionChange:re,"onUpdate:currentPage":ee,"onUpdate:pageSize":ae},{index:i(({index:e})=>[b(c(F(e)),1)]),avatar:i(({row:e})=>[s(Ee,{src:e.avatar,style:{width:"32px",height:"32px"}},null,8,["src"])]),roleName:i(({row:e,column:a})=>[s(Ue,{title:a.label,content:e.roleName.join("，"),placement:"top",width:"300"},{reference:i(()=>[d("span",ue,c(e.roleName.join("，")),1)]),_:2},1032,["title","content"])]),status:i(({row:e})=>[s(je,{type:"ENABLED"===e.status?"success":"danger",effect:"dark"},{default:i(()=>[b(c(u(J)("SYS_ENABLED_STATUS",e.status)||e.status),1)]),_:2},1032,["type"])]),gender:i(({row:e})=>[b(c(u(J)("GENDER",e.gender)||e.gender),1)]),operation:i(({row:e})=>[M((t(),n(ie,{type:"primary",link:"",size:"small",onClick:a=>function(e){ce.value=!0,pe.value={...e},de.value=!0}(e)},{default:i(()=>[...k[16]||(k[16]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Te,"sys:user:edit"]]),M((t(),n(ie,{type:"primary",link:"",size:"small",onClick:a=>function(e){pe.value={...e},ge.value=!0}(e)},{default:i(()=>[...k[17]||(k[17]=[b(" 分配角色 ",-1)])]),_:1},8,["onClick"])),[[Te,"sys:user:role"]]),s(Ae,{title:"请确认是否删除？",width:"160",placement:"top","confirm-button-type":"danger",onConfirm:a=>async function({id:e}){await H.sys.user.delete({ids:[e]}),S({type:"success",message:"删除成功"}),X()}(e)},{reference:i(()=>[M((t(),n(ie,{type:"danger",link:"",size:"small"},{default:i(()=>[...k[18]||(k[18]=[b("删除",-1)])]),_:1})),[[Te,"sys:user:delete"]])]),_:1},8,["onConfirm"])]),_:1},8,["height","loading","data","columns","total"])]),_:1}),s(q,{visible:u(de),"onUpdate:visible":k[5]||(k[5]=e=>_(de)?de.value=e:null),"is-edit":u(ce),"user-data":u(pe),onSuccess:fe},null,8,["visible","is-edit","user-data"]),s(Q,{visible:u(ge),"onUpdate:visible":k[6]||(k[6]=e=>_(ge)?ge.value=e:null),"user-data":u(pe),onSuccess:ve},null,8,["visible","user-data"]),s(We,{visible:u(we).visible,"onUpdate:visible":k[7]||(k[7]=e=>u(we).visible=e),title:"批量导入",loading:u(we).loading,limit:"1",onConfirm:Se},null,8,["visible","loading"]),s(Me,{visible:u(Ce).visible,title:u(Ce).title,loading:u(Ce).loading,confirmBtnType:"danger",onConfirm:Be,onCancel:Ve},null,8,["visible","title","loading"])])}}});export{re as default};
