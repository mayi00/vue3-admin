import{ax as e,j as a,k as l,w as o,m as r,ab as d,aA as s,u as t,p as u,H as i,G as p,aF as n,A as m,ac as c,ay as g,aa as y,C as f,a2 as b,r as v,x as V,E as k,a8 as _,aB as h,c as x}from"./OcaL6beW.js";import{a as C}from"./CFdA1usV.js";import{a as w}from"./CxAYDShj.js";const N={__name:"organizationFormDialog",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},orgData:{type:Object,default:()=>({})}},emits:["update:visible","success"],setup(N,{emit:T}){const E=N,I=T,U=v(null),j=v({id:"",parentId:"",orgName:"",orgType:"",sort:1,orgCode:"",remark:""}),q=V(()=>({orgName:[{required:!0,message:"请输入机构名称",trigger:["blur"]}],orgType:[{required:!0,message:"请选择机构分类",trigger:["change"]}],parentId:[{required:"COMPANY"!==j.value.orgType,message:"请选择上级机构",trigger:["change"]}],sort:[{required:!0,message:"请输入排序",trigger:["blur"]}],orgCode:[{required:!0,message:"请输入机构码",trigger:["blur"]}]})),z=v([]),A=v([]),D={label:"orgName",value:"id"};e(()=>E.visible,e=>{e&&((async()=>{const e=await C.sys.organization.list();0===e.code&&(z.value=e.data,A.value=z.value.map(e=>e.id))})(),E.isEdit?j.value=x(E.orgData):j.value.parentId=E.orgData.parentId)});const O=v(!1),R=()=>{U.value.validate(async e=>{if(e)try{if(O.value=!0,E.isEdit){const e=await C.sys.organization.update(j.value);0===e.code?k.success("编辑机构成功"):k.error(e.message||"编辑机构失败")}else{const e=await C.sys.organization.add(j.value);0===e.code?k.success("新增机构成功"):k.error(e.message||"新增机构失败")}I("success"),B()}catch(a){console.error("操作机构失败:",a)}finally{O.value=!1}})},B=()=>{U.value?.resetFields(),I("update:visible",!1)};return(e,v)=>{const V=h,k=s,x=d,C=n,T=c,E=g,I=y,F=b,P=_;return a(),l(P,{"model-value":N.visible,title:N.isEdit?"编辑":"新增",width:"500px","close-on-click-modal":!1,onClose:B},{footer:o(()=>[r(F,{type:"primary",loading:t(O),onClick:R},{default:o(()=>[...v[6]||(v[6]=[f("确定",-1)])]),_:1},8,["loading"]),r(F,{onClick:B},{default:o(()=>[...v[7]||(v[7]=[f("取消",-1)])]),_:1})]),default:o(()=>[r(I,{ref_key:"formRef",ref:U,model:t(j),rules:t(q),"label-width":"100px"},{default:o(()=>[r(x,{label:"机构分类",prop:"orgType"},{default:o(()=>[r(k,{modelValue:t(j).orgType,"onUpdate:modelValue":v[0]||(v[0]=e=>t(j).orgType=e),style:{width:"100%"},placeholder:"请选择机构分类",clearable:""},{default:o(()=>[(a(!0),u(p,null,i(t(w)("ORG_TYPE"),e=>(a(),l(V,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),"COMPANY"!==t(j).orgType?(a(),l(x,{key:0,label:"上级机构",prop:"parentId"},{default:o(()=>[r(C,{modelValue:t(j).parentId,"onUpdate:modelValue":v[1]||(v[1]=e=>t(j).parentId=e),data:t(z),props:D,"render-after-expand":!1,"check-strictly":"","node-key":"id","default-expanded-keys":t(A),style:{width:"100%"},placeholder:"选择上级机构",clearable:""},null,8,["modelValue","data","default-expanded-keys"])]),_:1})):m("",!0),r(x,{label:"机构名称",prop:"orgName"},{default:o(()=>[r(T,{modelValue:t(j).orgName,"onUpdate:modelValue":v[2]||(v[2]=e=>t(j).orgName=e),placeholder:"请输入机构名称",clearable:""},null,8,["modelValue"])]),_:1}),r(x,{label:"机构码",prop:"orgCode"},{default:o(()=>[r(T,{modelValue:t(j).orgCode,"onUpdate:modelValue":v[3]||(v[3]=e=>t(j).orgCode=e),disabled:N.isEdit,placeholder:"请输入机构码",clearable:""},null,8,["modelValue","disabled"])]),_:1}),r(x,{label:"排序",prop:"sort"},{default:o(()=>[r(E,{modelValue:t(j).sort,"onUpdate:modelValue":v[4]||(v[4]=e=>t(j).sort=e),min:1,max:9999,precision:0},null,8,["modelValue"])]),_:1}),r(x,{label:"备注",prop:"remark"},{default:o(()=>[r(T,{modelValue:t(j).remark,"onUpdate:modelValue":v[5]||(v[5]=e=>t(j).remark=e),type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入备注",maxlength:200,clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}};export{N as default};
