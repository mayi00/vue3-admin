import{_ as e}from"./BETcTfPP.js";import{_ as a}from"./DjzrIlqC.js";import{ao as l,j as t,p as i,m as s,w as o,ab as n,u,ag as d,ah as r,ac as c,ad as p,aA as v,G as m,H as f,a2 as g,C as b,a1 as y,y as h,at as _,aL as S,aR as k,D as C,r as E,E as w,k as x,aB as D}from"./DFilHWvT.js";import{h as A,a as V}from"./C762OUmN.js";import{a as z,g as N}from"./CxAYDShj.js";import{u as U}from"./5Ea9PFM7.js";import L from"./B7Eyxmba.js";import j from"./Cbf3qm4P.js";const B={class:"g-container"},P={class:"mb-[10px]"},T={class:"g-multi-ellipsis"},W={__name:"roleManage",setup(W){const R=E(null),F=E({roleName:"",status:""}),Y=l(()=>{G.value.currentPage=1,K()},300);function H(){R.value.resetFields(),Y()}const{elementHeight:I}=U({offset:275}),M=E(null),G=E({loading:!1,currentPage:1,pageSize:5,total:0,data:[],columns:[{type:"selection",width:50},{type:"index",label:"序号",minWidth:60,slot:"index"},{prop:"roleName",label:"角色名称",minWidth:150},{prop:"roleCode",label:"角色编码",minWidth:150},{prop:"remark",label:"备注",minWidth:200,slot:"remark"},{prop:"status",label:"状态",minWidth:80,slot:"status"},{prop:"operation",label:"操作",width:170,align:"center",fixed:"right",slot:"operation"}]}),J=E([]);function q(e){return G.value.pageSize*(G.value.currentPage-1)+e+1}function K(){const e={currentPage:G.value.currentPage,pageSize:G.value.pageSize},a={...F.value};G.value.loading=!0,V.sys.role.list(e,a).then(e=>{G.value.data=e.data.list,G.value.total=e.data.total}).catch(()=>{G.value.data=[],G.value.total=0}).finally(()=>{G.value.loading=!1})}function O(e){G.value.currentPage=e,K()}function Q(e){G.value.pageSize=e,K()}function X(e){J.value=e}function Z(e){J.value=e}const $=E({ids:[],title:"删除",visible:!1,loading:!1});function ee(){const e=M.value?.getSelectionRows();if(!e.length)return w.warning("请选择数据");$.value.ids=e.map(e=>e.id),$.value.title="批量删除",$.value.visible=!0}async function ae(){$.value.loading=!0;try{await V.sys.role.delete({ids:$.value.ids}),w({type:"success",message:"删除成功"}),$.value.visible=!1,$.value.loading=!1,K()}finally{$.value.loading=!1}}function le(){$.value.visible=!1,$.value.ids=[]}const te=E({}),ie=E({visible:!1,isEdit:!1});function se(){ie.value.isEdit=!1,te.value={},ie.value.visible=!0}function oe(){ie.value.visible=!1,K()}const ne=E({visible:!1,roleData:{}});function ue(){ne.value.visible=!1}return K(),(l,E)=>{const U=p,W=c,J=r,de=D,re=v,ce=g,pe=d,ve=n,me=y,fe=k,ge=S,be=_,ye=a,he=e;return t(),i("div",B,[s(me,{shadow:"hover","body-style":"padding-bottom: 0"},{default:o(()=>[s(ve,{ref_key:"searchFormRef",ref:R,model:u(F),"label-width":"80px"},{default:o(()=>[s(pe,null,{default:o(()=>[s(J,{span:6},{default:o(()=>[s(W,{label:"角色名称",prop:"roleName"},{default:o(()=>[s(U,{modelValue:u(F).roleName,"onUpdate:modelValue":E[0]||(E[0]=e=>u(F).roleName=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),s(J,{span:6},{default:o(()=>[s(W,{label:"状态",prop:"status"},{default:o(()=>[s(re,{modelValue:u(F).status,"onUpdate:modelValue":E[1]||(E[1]=e=>u(F).status=e),placeholder:"请选择状态",clearable:""},{default:o(()=>[(t(!0),i(m,null,f(u(z)("SYS_ENABLED_STATUS"),e=>(t(),x(de,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(J,{span:12,style:{"padding-left":"10px"}},{default:o(()=>[s(ce,{type:"primary",onClick:u(Y)},{default:o(()=>[...E[4]||(E[4]=[b("查询",-1)])]),_:1},8,["onClick"]),s(ce,{onClick:H},{default:o(()=>[...E[5]||(E[5]=[b("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(me,{shadow:"hover",style:{"margin-top":"10px"}},{default:o(()=>[h("div",P,[s(ce,{type:"primary",onClick:se},{default:o(()=>[...E[6]||(E[6]=[b("新增角色",-1)])]),_:1}),s(ce,{type:"danger",onClick:ee},{default:o(()=>[...E[7]||(E[7]=[b("批量删除",-1)])]),_:1})]),s(ye,{ref_key:"hyTableRef",ref:M,height:u(I),loading:u(G).loading,data:u(G).data,columns:u(G).columns,defaultPageSize:5,pageSizes:[5,10,20,50,100],total:u(G).total,onSelect:X,onSelectAll:Z,"onUpdate:currentPage":O,"onUpdate:pageSize":Q},{index:o(({index:e})=>[b(C(q(e)),1)]),remark:o(({row:e})=>[s(fe,{placement:"top",title:"备注",content:e.remark,trigger:"hover"},{reference:o(()=>[h("div",T,C(e.remark),1)]),_:2},1032,["content"])]),status:o(({row:e})=>[s(ge,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,disabled:!u(A)("sys:role:updateStatus"),"inline-prompt":"","active-value":"ENABLED","inactive-value":"DISABLED","active-text":u(N)("SYS_ENABLED_STATUS","ENABLED"),"inactive-text":u(N)("SYS_ENABLED_STATUS","DISABLED"),onChange:a=>function(e){e.id&&V.sys.role.updateStatus({id:e.id,status:e.status}).then(()=>{w({type:"success",message:"状态更新成功"})})}(e)},null,8,["modelValue","onUpdate:modelValue","disabled","active-text","inactive-text","onChange"])]),operation:o(({row:e})=>[s(ce,{type:"success",link:"",size:"small",onClick:a=>function(e){ne.value.roleData={...e},ne.value.visible=!0}(e)},{default:o(()=>[...E[8]||(E[8]=[b("分配权限",-1)])]),_:1},8,["onClick"]),s(ce,{type:"primary",link:"",size:"small",onClick:a=>function(e){ie.value.isEdit=!0,te.value={...e},ie.value.visible=!0}(e)},{default:o(()=>[...E[9]||(E[9]=[b("编辑",-1)])]),_:1},8,["onClick"]),s(be,{title:"请确认是否删除？",width:"160",placement:"top","confirm-button-type":"danger",onConfirm:a=>async function(e){await V.sys.role.delete({ids:[e.id]}),w({type:"success",message:"删除成功"}),K()}(e)},{reference:o(()=>[s(ce,{type:"danger",link:"",size:"small"},{default:o(()=>[...E[10]||(E[10]=[b("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1},8,["height","loading","data","columns","total"])]),_:1}),s(he,{visible:u($).visible,title:u($).title,loading:u($).loading,confirmBtnType:"danger",onConfirm:ae,onCancel:le},null,8,["visible","title","loading"]),s(L,{visible:u(ie).visible,"onUpdate:visible":E[2]||(E[2]=e=>u(ie).visible=e),"is-edit":u(ie).isEdit,"role-data":u(te),onSuccess:oe},null,8,["visible","is-edit","role-data"]),s(j,{visible:u(ne).visible,"onUpdate:visible":E[3]||(E[3]=e=>u(ne).visible=e),"role-data":u(ne).roleData,onSuccess:ue},null,8,["visible","role-data"])])}}};export{W as default};
